
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard SPI 2025</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { margin: 10px; padding: 10px 20px; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 5px; }
    table { margin-top: 20px; width: 100%; }
    input { padding: 5px; width: 300px; margin-top: 10px; }
  </style>
</head>
<body>

<h2>Dashboard Respon SPI 2025</h2>
<div>
  <button onclick="loadDataset('eksternal')">Tampilkan Data Eksternal</button>
  <button onclick="loadDataset('internal')">Tampilkan Data Internal</button>
</div>

<label for="instansiFilter">Filter Instansi:</label><br>
<input list="instansiList" id="instansiFilter" placeholder="Ketik nama instansi..." oninput="applyFilter()">
<datalist id="instansiList"></datalist>

<p id="status">Memuat data...</p>
<table id="data-table">
  <thead id="table-head"></thead>
  <tbody id="table-body"></tbody>
</table>

<canvas id="chart" width="400" height="150"></canvas>

<script>
var urlMap = {
  "eksternal": "https://raw.githubusercontent.com/timotiushps/tesdashboardspi24/main/rekap_response_rate_eksternal_total_only.csv",
  "internal": "https://raw.githubusercontent.com/timotiushps/tesdashboardspi24/main/rekap_response_rate_internal_total_only.csv"
};

var chartInstance = null;
var allData = [];
var currentData = [];

function loadDataset(type) {
  document.getElementById('status').innerText = 'Memuat data ' + type + '...';
  Papa.parse(urlMap[type], {
    download: true,
    header: true,
    dynamicTyping: true,
    complete: function(results) {
      allData = results.data;
      currentData = allData;
      populateInstansiList(allData);
      renderTable(currentData);
      renderChart(currentData);
      document.getElementById('status').innerText = 'Menampilkan data ' + type;
    }
  });
}

function populateInstansiList(data) {
  const instansiList = document.getElementById('instansiList');
  const unique = [...new Set(data.map(d => d.instansi).filter(d => d))].sort();
  instansiList.innerHTML = unique.map(d => `<option value="${d}">`).join('');
}

function applyFilter() {
  const keyword = document.getElementById('instansiFilter').value.toLowerCase();
  currentData = allData.filter(d => (d.instansi || '').toLowerCase().includes(keyword));
  renderTable(currentData);
  renderChart(currentData);
}

function renderTable(data) {
  const head = document.getElementById('table-head');
  const body = document.getElementById('table-body');
  head.innerHTML = '';
  body.innerHTML = '';

  if (data.length === 0) return;

  const headers = ['instansi', 'target', 'data_blast', 'persentase_capaian_target', 'persentase_response_rate_online', 'jumlah_capi'];
  const headerRow = '<tr>' + headers.map(h => '<th>' + h + '</th>').join('') + '</tr>';
  head.innerHTML = headerRow;

  data.forEach(row => {
    const rowHtml = '<tr>' + headers.map(h => '<td>' + (row[h] !== undefined ? row[h] : '') + '</td>').join('') + '</tr>';
    body.innerHTML += rowHtml;
  });
}

function renderChart(data) {
  const ctx = document.getElementById('chart').getContext('2d');
  const labels = data.map(d => d.instansi || '');
  const values = data.map(d => parseFloat(d.persentase_capaian_target || 0));

  if (chartInstance) {
    chartInstance.destroy();
  }

  chartInstance = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Capaian Target',
        data: values,
        backgroundColor: 'rgba(75, 192, 192, 0.6)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: true
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          max: 100
        }
      }
    }
  });
}

window.onload = function() {
  loadDataset('eksternal');
};
</script>
</body>
</html>
